\section{Definitions}
\label{sec:definitions}

\begin{itemize}
\item An \emph{interface} $I$ is a discrete graph.

\item An \emph{open graph} is an arrow $g\of I\to G$ where $I$ is an interface; we say that $g$ has \emph{interface} $I_g=I$ and \emph{pattern} $P_g=G$. Open graphs are used for different purposes: within a condition to associate (both upper and lower) interfaces with the patterns, and also as assignments --- that is, the objects on which satisfaction is defined.

\item An \emph{interface morphism} $f$ from $I$ to $J$ is a graph morphism $k:I\to J$.

\item An \emph{open graph morphism} $a\of g\to h$ a pair of graph morphisms $a^I:I_g\to I_h, a^P:P_g\to P_h$ such that $a^I;h=g;a^P$.
\end{itemize}
%
A \emph{condition tree} is a tuple $(V,E,\setof{d_v}_{v\in V},\setof{u_w}_{(v,w)\in C})$ such that

\begin{itemize}
\item $V$ is a set of vertices;

\item $C\subseteq V\times V$ is a set of edges representing the parent-child relation, such that one $v\in P$ (the \emph{root}) has no outgoing edge, and all other elements of $V$ have exactly one outgoing edge (to their \emph{parent});

\item for all $v\in V$, $d_v$ is an open graph. We denote $I_v=I_{d_v}$ and $P_v=P_{d_v}$.

\item for all $c=(v,w)\in C$, $u_w\of I_w\to P_v$ is an open graph.
\end{itemize}
%
The root of a tree $\cT$ is denoted $\rt\cT$; its \emph{root interface} is $I_\cT=I_{\rt\cT}$. For an arbitrary vertex $v\in V_\cT$, $\hat v$ will denote the subtree rooted at $v$.

\medskip\noindent Satisfaction of is defined for subtrees $\hat v$ and assignments $g\of I^v\to G$, as follows. $g\sat \hat v$ if there is an open graph morphism $(\id,h)\of d_v\to g$ such that $u_w;a_P\nsat \hat w$ for all children $w$ of $v$. $h$ is then called a \emph{witness} of $g\sat \hat v$.

\medskip\noindent
Given two condition trees $\cT,\cU$ with $V_\cT\cap V_\cU=\emptyset$, let $V=V_\cT\cup V_\cU$ and $C=C_\cT\cup C_\cU$. The set of \emph{pre-morphisms over $\cT$ and $\cU$}, denoted $\PreMorph$, is the smallest set such that for all $v,x\in V$ and all $a\of d_v\to d_x$, $(v,a,x)\in \PreMorph$ if for every child $w$ of $v$ one of the following holds:

\begin{enumerate}[label=\emph{(\roman*)}]
\item There is a child $y$ of $x$ and a pre-morphism $(y,b,w)\in\PreMorph$ such that $b^I;u_w;a^P=u_v$.
\item There is a child $y$ of $w$ and a pre-morphism $(y,b,x)\in\PreMorph$ such that, constructing the pullback $(u,d)$ of $(d_w,u_y)$, $d$ is epi and $u;u_w;a^P=d;d_y;b^P$.
\item There is a sibling $y$ of $x$, a pre-morphism $(y,b,w)\in\PreMorph$ and an interface morphism $k\of I_y\to I_x$ such that $u_y=k;u_x$ and $b^I;u_w;a^P=k;d_x$.
\end{enumerate}
%
Vacuously, the above is fulfilled if $v$ does not have children, hence in that case $(v,x,a)\in \PreMorph$ for all $a\of d_v\to d_x$; this will form the base case of our induction proofs.

The three conditions are visualised in \cref{fig:satisfaction-conditions}.

\begin{figure}
\input{figs/satisfaction-conditions}
\caption{The three cases of pre-morphisms}
\label{fig:satisfaction-conditions}
\end{figure}

\begin{proposition}
For all $(v,w,a)\in \PreMorph$, if $g\sat w$ with witness $h$, then $a^I;g\sat v$ with witness $a^P;h$.
\end{proposition}

